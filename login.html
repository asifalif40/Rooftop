<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Rooftop Gardening Portal â€“ Login</title>
<style>
  /* keep your design same */
  :root{
    --brand:#2e7d32;
    --brand-600:#1b5e20;
    --bg:#f5f7fa;
    --card:#ffffff;
    --muted:#6b7280;
    --border:#e5e7eb;
    --ring:#bbf7d0;
    --danger:#dc2626;
  }
  *{box-sizing:border-box}
  body{margin:0;min-height:100svh;background:var(--bg);
    font-family:system-ui,-apple-system,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;color:#111827;
    display:grid;place-items:center;padding:24px;}
  header{position:fixed;inset:0 0 auto 0;height:64px;background:#ffffffb3;
    backdrop-filter: blur(6px);border-bottom:1px solid var(--border);
    display:flex;align-items:center;gap:.75rem;padding:0 16px;}
  header .logo{width:36px;height:36px;border-radius:9px;background:#e8f5e9;
    display:grid;place-items:center;font-size:20px;}
  header h1{font-size:1.05rem;margin:0;color:var(--brand-600)}
  .wrap{margin-top:84px}
  .card{width:min(560px,94vw);background:var(--card);border:1px solid var(--border);
    border-radius:16px;padding:20px 20px 24px;box-shadow:0 10px 30px rgba(0,0,0,.06);}
  .subtitle{color:var(--muted);margin:.25rem 0 1rem}
  .role-tabs{display:flex;gap:.5rem;flex-wrap:wrap;margin-bottom:.75rem}
  .role-tabs button{flex:1 1 0;border:1px solid var(--border);background:#f9fafb;
    padding:.55rem .75rem;border-radius:10px;cursor:pointer;font-weight:700;transition:.15s;}
  .role-tabs button[aria-selected="true"]{background:#ecfdf5;border-color:#86efac;
    outline:2px solid var(--ring);color:var(--brand-600)}
  .field{margin-bottom:.9rem}
  label{display:block;font-weight:600;margin-bottom:.35rem}
  select,input{width:100%;border:1px solid var(--border);border-radius:10px;
    padding:.7rem .85rem;background:#fff;font-size:1rem}
  select:focus,input:focus{outline:3px solid var(--ring);border-color:#86efac}
  .error{color:var(--danger);font-size:.9rem;margin:.25rem 0 -.25rem}
  .btn{appearance:none;border:none;border-radius:10px;padding:.8rem 1rem;
    cursor:pointer;font-weight:800}
  .btn-primary{background:var(--brand);color:#fff;width:100%}
  .btn-primary:hover{background:var(--brand-600)}
  .links{display:flex;justify-content:space-between;align-items:center;gap:.75rem;margin-top:.85rem;flex-wrap:wrap}
  .link{color:var(--brand-600);text-decoration:none;font-weight:700}
  .link:hover{text-decoration:underline}
  .note{color:var(--muted);font-size:.92rem}
</style>
</head>
<body>
  <header>
    <div class="logo" aria-hidden="true">ðŸŒ¿</div>
    <h1>Rooftop Gardening Portal</h1>
  </header>

  <div class="wrap">
    <main class="card" role="main" aria-labelledby="title">
      <h2 id="title">Sign in</h2>
      <p class="subtitle">Login with your account credentials.</p>

      <form id="loginForm" novalidate>
        <div class="field">
          <label for="email">Email</label>
          <input id="email" type="email" placeholder="e.g., asif@example.com" required />
          <div id="emailErr" class="error" hidden>Please enter your email.</div>
        </div>

        <div class="field">
          <label for="password">Password</label>
          <input id="password" type="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" required />
          <div id="passErr" class="error" hidden>Please enter your password.</div>
        </div>

        <button class="btn btn-primary" type="submit">Login</button>
        <div id="loginErr" class="error" hidden>Invalid email or password.</div>

        <div class="links">
          <a href="#" id="forgotLink" class="link">Forgot Password?</a>
          <button type="button" id="createAccountBtn" class="btn btn-primary" style="width:auto;padding:.6rem 1.2rem;">Create New Account</button>
        </div>
      </form>
    </main>
  </div>

<script>
  const form = document.getElementById('loginForm');
  const email = document.getElementById('email');
  const password = document.getElementById('password');
  const emailErr = document.getElementById('emailErr');
  const passErr = document.getElementById('passErr');
  const loginErr = document.getElementById('loginErr');
  const DB_KEY = 'rgp_users';

  function loadUsers(){ try{ return JSON.parse(localStorage.getItem(DB_KEY)||'[]'); } catch { return []; } }

  async function sha256Hex(buffer){
    const hash = await crypto.subtle.digest('SHA-256', buffer);
    return [...new Uint8Array(hash)].map(b=>b.toString(16).padStart(2,'0')).join('');
  }
  function enc(str){ return new TextEncoder().encode(str); }

  form.addEventListener('submit', async (e)=>{
    e.preventDefault();
    emailErr.hidden = !!email.value.trim();
    passErr.hidden = !!password.value.trim();
    if(!email.value.trim() || !password.value.trim()) return;

    const users = loadUsers();
    const user = users.find(u => u.email === email.value.trim().toLowerCase());
    if(!user){ loginErr.hidden = false; return; }

    const hash = await sha256Hex(enc(user.salt + password.value));
    if(hash !== user.passwordHash){
      loginErr.hidden = false; return;
    }

    // success: redirect based on role
    if(user.role === "user") window.location.href = "homepage.html";
    else if(user.role === "specialist") window.location.href = "agrispecialist.html";
    else if(user.role === "admin") window.location.href = "admin.html";
  });

  document.getElementById('forgotLink').addEventListener('click', (e)=>{ 
    e.preventDefault(); alert('Reset link sent (demo).'); 
  });

  document.getElementById('createAccountBtn').addEventListener('click', ()=>{
    window.location.href = "createanewaccount.html";
  });
</script>
</body>
</html>
